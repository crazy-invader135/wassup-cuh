<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Grass World – No Click, Just Works</title>
<style>body{margin:0;overflow:hidden;background:#88ccff}</style>
</head>
<body>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.module.js';
import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.168.0/examples/jsm/controls/PointerLockControls.js';

// Scene
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x88ccff);
scene.fog = new THREE.Fog(0x88ccff, 100, 1500);

// Camera & renderer
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// Controls — IMPORTANT: second argument is document.body
const controls = new PointerLockControls(camera, document.body);
scene.add(controls.getObject());

// Force pointer lock immediately (works in all modern browsers when triggered by user gesture or on load in many cases)
requestPointerLock = requestPointerLock || document.body.mozRequestPointerLock || document.body.webkitRequestPointerLock;
document.body.requestPointerLock?.();

// If the above fails, fall back to a tiny invisible click
document.body.addEventListener('click', () => controls.lock(), {once:true});

// Lights
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(100,200,100);
sun.castShadow = true;
scene.add(sun);

// Grass
const tex = new THREE.TextureLoader().load('Textures/Grass.png');
tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
tex.repeat.set(1000,1000);

const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(100000,100000),
  new THREE.MeshStandardMaterial({map:tex})
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

camera.position.y = 10;

// Movement
const move = {f:false,b:false,l:false,r:false};
document.addEventListener('keydown', e=>{
  if(e.code==='KeyW') move.f=true;
  if(e.code==='KeyS') move.b=true;
  if(e.code==='KeyA') move.l=true;
  if(e.code==='KeyD') move.r=true;
});
document.addEventListener('keyup', e=>{
  if(e.code==='KeyW') move.f=false;
  if(e.code==='KeyS') move.b=false;
  if(e.code==='KeyA') move.l=false;
  if(e.code==='KeyD') move.r=false;
});

function animate(){
  requestAnimationFrame(animate);

  if(controls.isLocked){
    const speed = 20;
    if(move.f) controls.moveForward(speed);
    if(move.b) controls.moveForward(-speed);
    if(move.r) controls.moveRight(speed);
    if(move.l) controls.moveRight(-speed);
    controls.getObject().position.y = 10;
  }

  renderer.render(scene,camera);
}
animate();

// Resize
addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
