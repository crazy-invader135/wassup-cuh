<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Grass World â€“ 100% Working</title>
  <style>
    body { margin:0; overflow:hidden; background:#88ccff; }
    #click { position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
             background:rgba(0,0,0,0.5); color:white; font: bold 30px Arial; cursor:pointer; }
  </style>
</head>
<body>

<div id="click">CLICK TO START</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.module.js';
import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.168.0/examples/jsm/controls/PointerLockControls.js';

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x88ccff);
scene.fog = new THREE.Fog(0x88ccff, 100, 1000);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

const controls = new PointerLockControls(camera, document.body);
scene.add(controls.getObject());

document.getElementById('click').addEventListener('click', () => {
  controls.lock();
  document.getElementById('click').style.display = 'none';
});

// Lights
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(50, 100, 50);
sun.castShadow = true;
scene.add(sun);

// Grass
const grass = new THREE.TextureLoader().load('Textures/Grass.png');
grass.wrapS = grass.wrapT = THREE.RepeatWrapping;
grass.repeat.set(1000, 1000);

const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(50000, 50000),
  new THREE.MeshStandardMaterial({ map: grass })
);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

camera.position.y = 10;

// Movement
let move = {f:false, b:false, l:false, r:false};
const vel = new THREE.Vector3();
const dir = new THREE.Vector3();

document.addEventListener('keydown', e => {
  if (e.code==='KeyW') move.f = true;
  if (e.code==='KeyS') move.b = true;
  if (e.code==='KeyA') move.l = true;
  if (e.code==='KeyD') move.r = true;
});
document.addEventListener('keyup', e => {
  if (e.code==='KeyW') move.f = false;
  if (e.code==='KeyS') move.b = false;
  if (e.code==='KeyA') move.l = false;
  if (e.code==='KeyD') move.r = false;
});

function animate() {
  requestAnimationFrame(animate);

  if (controls.isLocked) {
    const delta = 0.016; // simple fixed delta works fine

    vel.x = vel.z = 0;
    if (move.f) vel.z -= 20;
    if (move.b) vel.z += 20;
    if (move.l) vel.x -= 20;
    if (move.r) vel.x += 20;

    controls.moveForward(-vel.z * delta * 60);
    controls.moveRight(-vel.x * delta * 60);

    controls.getObject().position.y = 10;
  }

  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
